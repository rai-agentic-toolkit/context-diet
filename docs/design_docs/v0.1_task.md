# Context-Diet Development Tasks

- [x] **Phase 0: Project Setup**
  - [x] Initialize Python project structure (`src/context_diet`, `tests/`)
  - [x] Create `pyproject.toml` using `secure-ingest` as a guide
  - [x] Configure `.pre-commit-config.yaml` using `secure-ingest` as a guide
  - [x] Set up testing directories including `tests/corpus_of_doom`
- [x] **Phase 1: Core Architecture**
  - [x] Implement `DietStrategy` abstract base class
  - [x] Create `StrategyRegistry` and `ContextDistiller` API
- [x] **Phase 2: Base Strategies (V0.1)**
  - [x] Implement `PlainTextDietStrategy` fallback
  - [x] Implement `PythonAstDietStrategy` (Scrub, Skeleton, Focus modes)
  - [x] Implement `JsonDietStrategy` (Streaming state machine)
- [x] **Phase 3: Testing & Validation**
  - [x] Write unit tests for AST edge cases
  - [x] Write unit tests for JSON edge cases
- [x] **Phase 4: Optional Formats and Edge Cases**
  - [x] Implement optional formats (SQL, YAML)
  - [x] Write tests for new formats
  - [x] Populate `tests/corpus_of_doom`
  - [x] Refine `detect_strategy` content sniffing logic

### Phase 5: The Hard Way (V0.2 Refactoring)
- [ ] Safe Structural Fallbacks: Prevent `PlainTextDietStrategy` truncation fallback. Return minimal valid structures or raise `ContextBudgetExceededError`.
- [ ] Safe Lexical Parsing: Replace regex in `SqlDietStrategy` and `YamlDietStrategy` with authentic tokenization (`sqlparse`, `ruamel.yaml`).
- [ ] Non-Destructive AST: Transition `PythonAstDietStrategy` to `LibCST` to preserve inline comments/formatting.
- [ ] Strict Tokenizer Contract: Add a `RuntimeWarning` when relying on the `default_token_heuristic`.
- [ ] Safe Sniffing: Enhance `distill` to fail gracefully upon sniffing misidentification instead of destructively slicing payloads.
- [ ] Move Documentation: Archive V0.1 agent MD artifacts into repository `docs/design_docs/`.
